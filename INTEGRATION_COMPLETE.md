# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è MAKS –±–æ—Ç–∞ —Å Web Backend - –ì–û–¢–û–í–û!

## üéØ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω –æ–±—â–∏–π AI –º–æ–¥—É–ª—å (`/ai_core`)
- ‚úÖ `engine.py` - –ï–¥–∏–Ω—ã–π AI –¥–≤–∏–∂–æ–∫ –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- ‚úÖ `tools.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (function calling)
- ‚úÖ `context.py` - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è AI

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–æ—Ç–∞ —Å Web Backend (`/chatbot/integrations`)
- ‚úÖ `web_backend.py` - –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î Web
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite –ë–î
  - –†–∞–±–æ—Ç–∞ —Å –º–æ–¥–µ–ª—è–º–∏ User, SleepRecord, Habit, Transaction
  - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥—É–ª–µ–π

### 3. AI –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –±–æ—Ç–∞ (`/chatbot/handlers`)
- ‚úÖ `ai_aiomax.py` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è aiomax –±–æ—Ç–∞
  - –ö–æ–º–∞–Ω–¥—ã: /start, /stats, /help
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ AI
  - Function calling –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
  - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
/OPTIMIZATION
‚îú‚îÄ‚îÄ ai_core/                    ‚úÖ –û–±—â–∏–π AI –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ engine.py              # –ï–¥–∏–Ω—ã–π AI engine (DeepSeek)
‚îÇ   ‚îú‚îÄ‚îÄ tools.py               # Function calling
‚îÇ   ‚îî‚îÄ‚îÄ context.py             # System prompts
‚îÇ
‚îú‚îÄ‚îÄ chatbot/                    ‚úÖ MAKS –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai_aiomax.py       # AI –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
‚îÇ   ‚îî‚îÄ‚îÄ integrations/
‚îÇ       ‚îî‚îÄ‚îÄ web_backend.py     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Web –ë–î
‚îÇ
‚îî‚îÄ‚îÄ Web/
    ‚îú‚îÄ‚îÄ backend/
    ‚îÇ   ‚îú‚îÄ‚îÄ models/            # –ú–æ–¥–µ–ª–∏ –ë–î (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–æ—Ç–æ–º)
    ‚îÇ   ‚îú‚îÄ‚îÄ api/               # API (—á–∞—Ç –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω)
    ‚îÇ   ‚îî‚îÄ‚îÄ eidos.db           # –ë–î (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ—Ç–æ–º)
    ‚îî‚îÄ‚îÄ frontend/
        ‚îî‚îÄ‚îÄ app/dashboard/
            ‚îî‚îÄ‚îÄ chat/          # –ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

–î–æ–±–∞–≤–∏—Ç—å –≤ `config.py`:
```python
class BotConfig:
    token = "YOUR_MAKS_BOT_TOKEN"
    deepseek_api_key = "YOUR_DEEPSEEK_API_KEY"
    web_db_url = "sqlite+aiosqlite:///../Web/backend/eidos.db"
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å bot.py

```python
from handlers.ai_aiomax import register_ai_handlers

def create_bot() -> aiomax.Bot:
    bot = aiomax.Bot(bot_config.token)
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º AI –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    register_ai_handlers(bot)
    
    return bot
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
cd chatbot
python bot.py
```

## üí¨ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ MAKS:

**–°–æ–Ω:**
```
üë§: –Ø —Å–ø–∞–ª 8 —á–∞—Å–æ–≤, –∫–∞—á–µ—Å—Ç–≤–æ 9/10

ü§ñ: ‚úÖ –ó–∞–ø–∏—Å–∞–ª! 8 —á–∞—Å–æ–≤ —Å–Ω–∞ —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 9/10 - –æ—Ç–ª–∏—á–Ω–æ!
    –¢–≤–æ—è —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ–ø–µ—Ä—å 7.5 —á–∞—Å–æ–≤.
```

**–ü—Ä–∏–≤—ã—á–∫–∏:**
```
üë§: –°–æ–∑–¥–∞–π –ø—Ä–∏–≤—ã—á–∫—É –º–µ–¥–∏—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å

ü§ñ: ‚úÖ –ü—Ä–∏–≤—ã—á–∫–∞ "–ú–µ–¥–∏—Ç–∞—Ü–∏—è" —Å–æ–∑–¥–∞–Ω–∞!
    –ë—É–¥—É –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å —Ç–µ–±–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.
```

**–§–∏–Ω–∞–Ω—Å—ã:**
```
üë§: –ü–æ—Ç—Ä–∞—Ç–∏–ª 500 –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã

ü§ñ: ‚úÖ –†–∞—Å—Ö–æ–¥ 500‚ÇΩ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–ü—Ä–æ–¥—É–∫—Ç—ã"
    –¢–≤–æ–π —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: 25,000‚ÇΩ
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
```
üë§: /stats

ü§ñ: üìä –¢–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

    üåô –°–æ–Ω:
    ‚Ä¢ –ó–∞–ø–∏—Å–µ–π: 15
    ‚Ä¢ –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 7.5—á
    ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ: 8.2/10

    üí™ –ü—Ä–∏–≤—ã—á–∫–∏:
    ‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö: 3
      - üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è
      - üìö –ß—Ç–µ–Ω–∏–µ
      - üèÉ –ó–∞—Ä—è–¥–∫–∞

    üí∞ –§–∏–Ω–∞–Ω—Å—ã:
    ‚Ä¢ –ë–∞–ª–∞–Ω—Å: 25,000‚ÇΩ
    ‚Ä¢ –î–æ—Ö–æ–¥—ã: 50,000‚ÇΩ
    ‚Ä¢ –†–∞—Å—Ö–æ–¥—ã: 25,000‚ÇΩ
```

## üóëÔ∏è –ß—Ç–æ —É–¥–∞–ª–∏—Ç—å –∏–∑ Web

### –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ - —É–¥–∞–ª–∏—Ç—å –≤–µ–±-—á–∞—Ç:

**Backend:**
```bash
# –£–¥–∞–ª–∏—Ç—å
rm Web/backend/api/chat.py
rm Web/backend/models/chat.py  # –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

**Frontend:**
```bash
# –£–¥–∞–ª–∏—Ç—å
rm -rf Web/frontend/src/app/dashboard/chat/
```

**–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é:**
```tsx
// –í Web/frontend/src/app/dashboard/page.tsx
// –£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É "–ß–∞—Ç —Å –ò–ò"
// –ò–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–æ—Ç—É"
```

## üìù –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–∏–≤—ã—á–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –î–æ—Å—Ç—É–ø —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä

### –î–ª—è —Å–∏—Å—Ç–µ–º—ã:
- ‚úÖ –ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ AI
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- ‚úÖ –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:
- ‚úÖ –û–±—â–∏–π AI –º–æ–¥—É–ª—å
- ‚úÖ –ï–¥–∏–Ω–∞—è –ë–î
- ‚úÖ Function calling —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°–≤—è–∑—å MAKS ID —Å User ID

–ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å email:
```python
email = f"maks_{maks_id}@bot.local"
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –£–Ω–∏–∫–∞–ª—å–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞
- –°–≤—è–∑–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ Web
- –ò–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### Function Calling

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `create_sleep_record` - —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –æ —Å–Ω–µ
- `get_sleep_stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–Ω–∞
- `create_habit` - —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É
- `log_habit` - –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- `create_transaction` - –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- `get_finance_stats` - —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

–•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –±–æ—Ç–∞:
```python
user_histories = {
    user_id: [
        {"role": "user", "content": "..."},
        {"role": "assistant", "content": "..."}
    ]
}
```

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ:**
- –í–µ–±-—á–∞—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –û—Ç–¥–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ AI
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

**–ü–æ—Å–ª–µ:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ MAKS
- –û–±—â–∏–π AI –º–æ–¥—É–ª—å
- –ï–¥–∏–Ω–∞—è –ë–î
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞:**
   ```bash
   cd chatbot
   python bot.py
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏:**
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –æ —Å–Ω–µ
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

3. **–£–¥–∞–ª–∏—Ç—å –≤–µ–±-—á–∞—Ç:**
   - –£–¥–∞–ª–∏—Ç—å frontend —Å—Ç—Ä–∞–Ω–∏—Ü—É
   - –£–¥–∞–ª–∏—Ç—å backend API
   - –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é

4. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:**
   - –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–æ—Ç—É
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞! –ë–æ—Ç –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ –º–æ–¥—É–ª—è–º–∏ Web —á–µ—Ä–µ–∑ MAKS!** üéâ‚ú®
