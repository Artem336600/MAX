# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Function Calling

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
–ò–ò –Ω–µ –≤—ã–∑—ã–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏–∏, –∞ –ø—Ä–æ—Å—Ç–æ "–ø—Ä–∏—Ç–≤–æ—Ä—è–ª—Å—è" —á—Ç–æ —Å–æ–∑–¥–∞–ª –∑–∞–ø–∏—Å—å.

### –ü—Ä–∏—á–∏–Ω—ã
1. **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—ã–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏** - –≤–∫–ª—é—á–∞—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ `mood` –∏ `notes`
2. **–ù–µ—á–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏** - –ò–ò –Ω–µ –ø–æ–Ω–∏–º–∞–ª –∫–æ–≥–¥–∞ –µ—ë –≤—ã–∑—ã–≤–∞—Ç—å

### –†–µ—à–µ–Ω–∏–µ

**1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```python
class ModuleFunction:
    def __init__(self, ..., required: List[str] = None):
        self.required = required or []
    
    def to_openai_function(self):
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ "(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
        # –ò–õ–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ required
```

**2. –Ø–≤–Ω–æ —É–∫–∞–∑–∞–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
functions.append(ModuleFunction(
    name="create_sleep_record",
    description="–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –æ —Å–Ω–µ. –í–ê–ñ–ù–û: –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç –æ —Å–Ω–µ.",
    parameters={...},
    required=["quality", "duration", "sleep_time", "wake_time"]
))
```

**3. –£–ª—É—á—à–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ "–í–ê–ñ–ù–û: –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é"
- –ß–µ—Ç–∫–æ —É–∫–∞–∑–∞–Ω–æ –∫–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–º–µ—á–µ–Ω—ã "(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"

## üéØ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### –§–æ—Ä–º–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è OpenAI:
```json
{
  "name": "create_sleep_record",
  "description": "–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –æ —Å–Ω–µ. –í–ê–ñ–ù–û: –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç –æ —Å–Ω–µ.",
  "parameters": {
    "type": "object",
    "properties": {
      "quality": {"type": "integer", "description": "–ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ –æ—Ç 1 –¥–æ 10"},
      "duration": {"type": "number", "description": "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞ –≤ —á–∞—Å–∞—Ö"},
      "sleep_time": {"type": "string", "description": "–í—Ä–µ–º—è –∑–∞—Å—ã–ø–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601"},
      "wake_time": {"type": "string", "description": "–í—Ä–µ–º—è –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601"},
      "mood": {"type": "string", "description": "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"},
      "notes": {"type": "string", "description": "–ó–∞–º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"}
    },
    "required": ["quality", "duration", "sleep_time", "wake_time"]
  }
}
```

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:
- ‚úÖ `mood` –∏ `notes` —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- ‚úÖ –ò–ò –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –±–µ–∑ –Ω–∏—Ö
- ‚úÖ –ß–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å

## üöÄ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend
```bash
cd backend
python main.py
```

### 2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –ò–ò
```
"–Ø —Å–ø–∞–ª 8 —á–∞—Å–æ–≤, –∫–∞—á–µ—Å—Ç–≤–æ 9/10"
```

### 3. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∏:
```
INFO: AI called function: create_sleep_record
INFO: Arguments (parsed): {'quality': 9, 'duration': 8, ...}
INFO: Executing builtin function: create_sleep_record
INFO: Method: POST, URL: http://localhost:8001/api/v1/sleep/records
INFO: Response status: 201
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ UI
```
/dashboard/sleep
```
–ó–∞–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è!

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–Ø —Å–ø–∞–ª 8 —á–∞—Å–æ–≤, –∫–∞—á–µ—Å—Ç–≤–æ 9"

–ò–ò –≤—ã–∑–æ–≤–µ—Ç:
{
  "quality": 9,
  "duration": 8,
  "sleep_time": "2025-11-14T23:00:00",
  "wake_time": "2025-11-15T07:00:00"
}
```

### –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–Ø —Å–ø–∞–ª 8 —á–∞—Å–æ–≤, –∫–∞—á–µ—Å—Ç–≤–æ 9, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ—Ç–ª–∏—á–Ω–æ–µ, –ø—Ä–æ—Å–Ω—É–ª—Å—è –±–æ–¥—Ä—ã–º"

–ò–ò –≤—ã–∑–æ–≤–µ—Ç:
{
  "quality": 9,
  "duration": 8,
  "sleep_time": "2025-11-14T23:00:00",
  "wake_time": "2025-11-15T07:00:00",
  "mood": "great",
  "notes": "–ü—Ä–æ—Å–Ω—É–ª—Å—è –±–æ–¥—Ä—ã–º"
}
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
```
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
INFO: AI called function: create_sleep_record

# –ï—Å–ª–∏ –Ω–µ—Ç - –ò–ò –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –§—É–Ω–∫—Ü–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ OpenAI API
2. –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ—è—Å–Ω–æ–µ
3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `functions` –Ω–µ –ø—É—Å—Ç–æ–π –≤ `chat.py`
- –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `logger.info(f"Available functions: {len(functions)}")`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏: `logger.info(f"Function format: {functions[0]}")`

### –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
```
INFO: Executing builtin function: create_sleep_record
INFO: Response status: 201  # –î–æ–ª–∂–µ–Ω –±—ã—Ç—å 201
```

**–ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å 400/422:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

**–ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å 401:**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `create_access_token`

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ò–ò —Ç–µ–ø–µ—Ä—å:**
- ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ü–æ–Ω–∏–º–∞–µ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:**
- üí¨ –ì–æ–≤–æ—Ä–∏—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–º
- ‚ö° –ë—ã—Å—Ç—Ä–æ –¥–æ–±–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ
- üìä –í–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–∑—É
- üéØ –ù–µ –¥—É–º–∞—Ç—å –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö

---

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞!** üöÄ‚ú®

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

–¢–∞–∫–∏–µ –∂–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –¥—Ä—É–≥–∏–º —Ñ—É–Ω–∫—Ü–∏—è–º:
- `create_habit` - required: ["name", "frequency"]
- `create_transaction` - required: ["type", "amount", "category"]
- `log_habit` - required: ["habit_id"]

–ù–æ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ `create_sleep_record` —Ä–∞–±–æ—Ç–∞–µ—Ç!
